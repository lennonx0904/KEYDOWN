(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){},185:function(e,t,n){},186:function(e,t,n){},187:function(e,t,n){},188:function(e,t,n){},189:function(e,t,n){},190:function(e,t,n){},191:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(52),c=n.n(o),i=n(8),l=n(26),s=n(87),u=(n(100),n(2)),m=n(3),d=n(5),h=n(4),p=n(6),g=n(20),f=n(27),E=function(){return r.a.createElement("div",{className:"logo"},r.a.createElement(g.b,{to:"/"},"KEYDOWN"))},b=function(e){return{type:"SHOW_LOGIN_FORM",payload:e}},v=function(e){return{type:"SHOW_SIGNUP_FORM",payload:e}},y=function(e){return{type:"SHOW_MOBILE_BUTTONS",payload:e}},S=n(68),O=n.n(S);n(85),n(180);O.a.initializeApp({apiKey:"AIzaSyBpuiUbM6r9pKhzKP6xHSSaANIEe_rwPrc",authDomain:"keyboard-game-64e45.firebaseapp.com",databaseURL:"https://keyboard-game-64e45.firebaseio.com",projectId:"keyboard-game-64e45",storageBucket:"keyboard-game-64e45.appspot.com",messagingSenderId:"697558300831"});var w=O.a,A=w.firestore(),N=function(){return function(e){w.auth().signOut().then(function(){e({type:"LOGOUT_SUCCESS"})})}},j=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).renderLogInAndSignUpBtn=function(){var e=n.props,t=e.showing,a=e.showLoginForm,o=e.showSignUpForm;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"log-in nav-button",onClick:function(){a(!0)},disabled:t.signUpForm},"Log In"),r.a.createElement("button",{className:"sigh-in nav-button",onClick:function(){o(!0)},disabled:t.loginForm},"Sign Up"))},n.renderLogOutBtn=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"log-out nav-button",onClick:n.props.logOut},"Log Out"))},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"buttons"},this.props.auth.uid?this.renderLogOutBtn():this.renderLogInAndSignUpBtn())}}]),t}(r.a.Component),k=Object(i.b)(function(e){return{auth:e.auth,showing:e.showing}},{showLoginForm:b,showSignUpForm:v,logOut:N})(j),C=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).renderLogInAndSignUpBtn=function(){var e=n.props,t=e.showLoginForm,a=e.showSignUpForm,o=e.showMobileButtons;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"mobile-btn",onClick:function(){o(!1),t(!0)}},"Log In"),r.a.createElement("button",{className:"mobile-btn",onClick:function(){o(!1),a(!0)}},"Sign Up"))},n.renderLogOutBtn=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"mobile-btn",onClick:n.props.logOut},"Log Out"))},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.auth;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mobile-buttons"},e.uid?this.renderLogOutBtn():this.renderLogInAndSignUpBtn()))}}]),t}(r.a.Component),I=Object(i.b)(function(e){return{auth:e.auth,showing:e.showing}},{showLoginForm:b,showSignUpForm:v,logOut:N,showMobileButtons:y})(C),L=n(89),F=n.n(L),R=(n(185),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.checkAuthState()}},{key:"render",value:function(){var e=this.props,t=e.showing,n=e.showMobileButtons,a=e.auth;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"nav-bar"},r.a.createElement(E,null),a.name?r.a.createElement("div",{className:"greeting"},"Hi ! ",a.name):null,r.a.createElement("button",{className:"menu-button",disabled:t.loginForm||t.signUpForm,onClick:function(){var e=t.mobileButtons;n(!e)}},r.a.createElement("img",{src:F.a,alt:""})),r.a.createElement(k,null)),t.mobileButtons?r.a.createElement(I,null):null)}}]),t}(r.a.Component)),T=Object(i.b)(function(e){return{auth:e.auth,showing:e.showing}},{checkAuthState:function(){return function(e){w.auth().onAuthStateChanged(function(t){t?(e({type:"FETCH_USER_UID",payload:t.uid}),A.collection("users").doc(t.uid).get().then(function(t){t&&e({type:"FETCH_USER_NAME",payload:t.data().userName})})):e({type:"FETCH_USER_UID",payload:null})})}},showMobileButtons:y})(R),_=n(30),U=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state={userName:"",email:"",password:"",comfirmPassword:""},n.changeInputState=function(e){n.setState(Object(_.a)({},e.target.name,e.target.value))},n.submitHandler=function(e){e.preventDefault(),n.props.signUp(n.state)},n.renderSignUpForm=function(){return r.a.createElement("div",{className:"auth-view"},r.a.createElement("div",{className:"auth-wrap"},r.a.createElement("form",{className:"signup-form",onSubmit:n.submitHandler},r.a.createElement("i",{className:"fas fa-times exit-btn",onClick:function(){n.props.showSignUpForm(!1)}}),r.a.createElement("div",null,r.a.createElement("label",null,"Name"),r.a.createElement("br",null),r.a.createElement("input",{type:"text",name:"userName",value:n.state.userName,onChange:n.changeInputState})),r.a.createElement("div",null,r.a.createElement("label",null,"E-mail"),r.a.createElement("br",null),r.a.createElement("input",{type:"text",name:"email",value:n.state.email,onChange:n.changeInputState})),r.a.createElement("div",null,r.a.createElement("label",null,"Password"),r.a.createElement("br",null),r.a.createElement("input",{type:"password",name:"password",value:n.state.password,onChange:n.changeInputState})),r.a.createElement("div",null,r.a.createElement("label",null,"Comfirm Your Password"),r.a.createElement("br",null),r.a.createElement("input",{type:"password",name:"comfirmPassword",value:n.state.comfirmPassword,onChange:n.changeInputState})),r.a.createElement("button",{className:"submit-btn"},"Sigh Up"),r.a.createElement("div",null,n.props.auth.authError?r.a.createElement("p",null,n.props.auth.authError):null))))},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.auth.uid?null:this.renderSignUpForm())}}]),t}(r.a.Component),x=Object(i.b)(function(e){return{signUpForm:e.signUpForm,auth:e.auth}},{showSignUpForm:v,signUp:function(e){return function(t){var n=e.userName,a=e.email,r=e.password,o=e.comfirmPassword;""!==n?r===o?w.auth().createUserWithEmailAndPassword(a,r).then(function(e){var r=e.user.uid;t({type:"STORE_USER_UID",payload:r}),A.collection("users").doc(r).set({userName:n,email:a})}).then(function(){t({type:"SIGH_UP_SUCCESS"})}).catch(function(e){t({type:"SIGH_UP_ERROR",payload:e.message})}):t({type:"SIGH_UP_ERROR",payload:"Please comfirm your password"}):t({type:"SIGH_UP_ERROR",payload:"Please enter your name"})}}})(U),D=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state={email:"",password:""},n.changeInputState=function(e){n.setState(Object(_.a)({},e.target.name,e.target.value))},n.submitHandler=function(e){e.preventDefault(),n.props.logIn(n.state)},n.renderLogInForm=function(){return r.a.createElement("div",{className:"auth-view"},r.a.createElement("div",{className:"auth-wrap"},r.a.createElement("form",{className:"login-form",onSubmit:n.submitHandler},r.a.createElement("i",{className:"fas fa-times exit-btn",onClick:function(){n.props.showLoginForm(!1)}}),r.a.createElement("div",null,r.a.createElement("label",null,"E-mail"),r.a.createElement("br",null),r.a.createElement("input",{type:"text",name:"email",onChange:n.changeInputState})),r.a.createElement("div",null,r.a.createElement("label",null,"Password"),r.a.createElement("br",null),r.a.createElement("input",{type:"password",name:"password",onChange:n.changeInputState})),r.a.createElement("button",{className:"submit-btn"},"Login"),r.a.createElement("div",null,n.props.auth.authError?r.a.createElement("p",null,n.props.auth.authError):null))))},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.auth.uid?null:this.renderLogInForm())}}]),t}(r.a.Component),M=Object(i.b)(function(e){return{auth:e.auth}},{showLoginForm:b,logIn:function(e){return function(t){w.auth().signInWithEmailAndPassword(e.email,e.password).then(function(){w.auth().onAuthStateChanged(function(e){t({type:"LOGIN_SUCCESS"})})}).catch(function(e){t({type:"LOGIN_ERROR",payload:e})})}}})(D),P=(n(186),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.showing,t=e.signUpForm,n=e.loginForm;return r.a.createElement(r.a.Fragment,null,t&&r.a.createElement(x,null),n&&r.a.createElement(M,null))}}]),t}(r.a.Component)),G=Object(i.b)(function(e){return{showing:e.showing}})(P),H=(n(187),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"banner"},r.a.createElement("div",{className:"enter-wrap"},r.a.createElement("div",{className:"enter-btn"},r.a.createElement(g.b,{to:"/select"},"Enter Game"))))}}]),t}(r.a.Component)),B=n(90),W=w.firestore(),Y=(n(188),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchSongList()}},{key:"renderSongList",value:function(){return this.props.songList.map(function(e){return r.a.createElement("div",{key:e.id,className:"song"},r.a.createElement("div",{className:"song-details"},r.a.createElement("div",{className:"song-title"},e.data.title),r.a.createElement("div",{className:"song-auth"},e.data.auth)),r.a.createElement("div",{className:"difficulty-wrap"},r.a.createElement(g.b,{to:"/game/".concat(e.id,"?easy")},r.a.createElement("button",{className:"difficulty easy",name:e.data.name},"EASY")),r.a.createElement(g.b,{to:"/game/".concat(e.id,"?normal")},r.a.createElement("button",{className:"difficulty normal",name:e.data.name},"NORMAL")),r.a.createElement(g.b,{to:"/game/".concat(e.id,"?hard")},r.a.createElement("button",{className:"difficulty hard",name:e.data.name},"HARD"))))})}},{key:"render",value:function(){return r.a.createElement("div",{className:"song-list-wrap"},r.a.createElement("div",{className:"song-list"},this.renderSongList()))}}]),t}(r.a.Component)),Q=Object(i.b)(function(e){return{songList:e.songList,playingSongData:e.playingSongData}},{fetchSongList:function(){return function(e){var t=[];W.collection("songList").orderBy("id").get().then(function(n){return n.forEach(function(n){t=[].concat(Object(B.a)(t),[{id:n.id,data:n.data()}]),e({type:"FETCH_SONG_LIST",payload:t})})})}}})(Y),Z=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return r.a.createElement("canvas",{id:"game-canvas",width:this.props.width,height:this.props.height})}}]),t}(r.a.Component),J=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return r.a.createElement("canvas",{ref:this.props.getCanvas,id:"player-canvas",width:this.props.width,height:this.props.height})}}]),t}(r.a.Component),q=function(e){return r.a.createElement("div",{className:"battle-board"},"Best Record",e.record.slice(0,1).map(function(e){return r.a.createElement("div",{className:"score-in-board",key:e.id},e.data.score)}))},K=function(){return r.a.createElement("div",{className:"battle-board"},"Socre",r.a.createElement("div",{className:"score-in-board current-socre"},"0"))},V=w.firestore(),z=w.firestore(),X=function(e,t){return function(n){var a=[];z.collection("songList").doc(e).collection(t).orderBy("score","desc").limit(10).get().then(function(e){e.forEach(function(e){a.push({id:e.id,data:e.data()}),n({type:"FETCH_RANKING_RECORD",payload:a})})})}},$=function(e,t){var n=JSON.parse(localStorage.rankingData);n[e]=t,localStorage.rankingData=JSON.stringify(n)},ee=function(e,t,n){var a=document.querySelector("#player-canvas").getContext("2d"),r=18*n,o=13*n;a.beginPath(),a.moveTo(e*n,0),a.lineTo((e+1)*n,0),a.lineTo(r*t/4,o),a.lineTo(r*(t-1)/4,o),a.closePath(),a.fillStyle="rgba(255,255,255,0.1)",a.fill()},te=function(e){document.querySelector("#player-canvas").getContext("2d").clearRect(0,0,18*e,13*e)},ne=function(e,t,n,a){var r=document.querySelector("#player-canvas").getContext("2d"),o=18*t,c=13*t;r.save(),r.beginPath(),r.translate(o*e/4-o/8,12*t-12),r.fillStyle="#fff",r.textAlign="center",r.font="".concat(t,"px Courier New"),r.fillText(n,0,0),r.restore(),a>1&&(r.save(),r.beginPath(),r.translate(o/2,c/2),r.fillStyle="#fff",r.textAlign="center",r.font="".concat(t,"px Courier New"),r.fillText("COMBO ".concat(a),0,0),r.restore()),setTimeout(function(){r.clearRect(0,0,o,c)},100)},ae=function(e,t){var n=document.querySelector("#game-canvas").getContext("2d"),a=18*e,r=13*e;n.clearRect(0,0,a,r);var o=0,c=setInterval(function(){0===t?o=0:o+=98,n.clearRect(0,0,a,r),n.rect(0,0,a,r),n.fillStyle="#1d1d1d",n.fill(),n.save(),n.beginPath(),n.translate(a/2,r/4),n.textAlign="center",n.font="".concat(e,"px Courier New"),n.fillStyle="#fff",n.fillText("You got ".concat(o," points!"),0,0),n.translate(0,r/4),n.fillText("Click to Ranking Page",0,0),n.restore(),o>=t&&clearInterval(c)},5)},re=function(){if(localStorage.rankingData){var e,t=JSON.parse(localStorage.rankingData),n=t.name,a=t.total,r=t.hit,o=t.miss,c=t.combo,i=98*r,l=Math.round(r/a*100);return e=l>=90?"A":l>=80?"B":l>=70?"C":l>=60?"D":"E",console.log({name:n,total:a,hit:r,miss:o,combo:c,score:i,accurate:l,rank:e}),{name:n,total:a,hit:r,miss:o,combo:c,score:i,accurate:l,rank:e}}},oe=function(e,t,n,a){n.play();var r=e/5,o=100,c=0,i=[],l=[],s=[],d=[],h=0,p=0,g=.2;"easy"===a&&(o/=2),"hard"===a&&(o*=2);var f=document.querySelector("#game-canvas").getContext("2d"),E=18*e,b=13*e,v=Math.atan2(b,E/2-2*e),y=Math.atan2(E/2*Math.tan(v),E/2/2),S=2*e*Math.tan(v);f.line=function(e,t,n,a,r){f.beginPath(),f.moveTo(e.x,e.y),f.lineTo(t.x,t.y),f.strokeStyle=n,f.shadowBlur=60,f.shadowColor=a,f.lineWidth=r,f.stroke()};var O=function e(t,n){Object(u.a)(this,e),this.x=t||0,this.y=n||0},w=function(){function t(n){Object(u.a)(this,t);var a={centerPos:new O(E/2,0),pos1:new O(-2*e,0),pos2:new O(-e,0),color:"#75d0f5",shadowColor:"#599eba",height:e/5,speed:r};Object.assign(a,n),Object.assign(this,a)}return Object(m.a)(t,[{key:"render",value:function(){f.save(),f.beginPath(),f.translate(this.centerPos.x,this.centerPos.y),f.line(this.pos1,this.pos2,this.color,this.shadowColor,this.height),f.restore()}},{key:"update",value:function(){this.centerPos.y+=this.speed,0!==this.pos1.x&&0!==this.pos2.x?(this.pos1.x=(this.centerPos.y+S)/Math.tan(v)*(this.pos1.x/Math.abs(this.pos1.x)),this.pos2.x=(this.centerPos.y+S)/Math.tan(y)*(this.pos2.x/Math.abs(this.pos2.x))):(this.pos1.x=(this.centerPos.y+S)/Math.tan(y)*(this.pos1.x/Math.abs(this.pos1.x)),this.pos2.x=0)}}]),t}(),A=function(){f.clearRect(0,0,18*e,13*e),N(),i.forEach(function(e){return e.render()}),l.forEach(function(e){return e.render()}),s.forEach(function(e){return e.render()}),d.forEach(function(e){return e.render()})},N=function(){for(var t=0;t<5;t++)f.line({x:(t+7)*e,y:0},{x:18*e/4*t,y:13*e},"#000",null,1);f.beginPath(),f.moveTo(7*e,0),f.lineTo(11*e,0),f.lineTo(18*e,13*e),f.lineTo(0,13*e),f.closePath(),f.fillStyle="rgba(0,0,0,.8)",f.fill(),f.line({x:.5*e,y:12*e},{x:17.5*e,y:12*e},"rgba(142, 226, 163, 0.8)",null,2)},j=setInterval(function(){!function(){var a=function(e){return parseFloat(e.toFixed(1))},r=a(n.currentTime),u=a(60/o);if(a(r-g)===u){g+=u,h+=t[++c].filter(function(e){return 1===e}).length;for(var m=0;m<4;m++)if(1===t[c][m])switch(m){case 0:return i.push(new w);case 1:return l.push(new w({pos1:new O(-e,0),pos2:new O,color:"#ff0000",shadowColor:"#ff5a5a"}));case 2:return s.push(new w({pos1:new O(e,0),pos2:new O,color:"#83ff2b",shadowColor:"#6fd328"}));case 3:return d.push(new w({pos1:new O(e,0),pos2:new O(2*e,0),color:"#ffff00",shadowColor:"#fcfc68"}));default:return}}i.forEach(function(e){return e.update()}),l.forEach(function(e){return e.update()}),s.forEach(function(e){return e.update()}),d.forEach(function(e){return e.update()}),i.forEach(function(t,n){t.centerPos.y>b&&(ne(1,e,"MISS"),p++,i.splice(n,1),$("combo",0))}),l.forEach(function(t,n){t.centerPos.y>b&&(ne(2,e,"MISS"),p++,l.splice(n,1),$("combo",0))}),s.forEach(function(t,n){t.centerPos.y>b&&(ne(3,e,"MISS"),p++,s.splice(n,1),$("combo",0))}),d.forEach(function(t,n){t.centerPos.y>b&&(ne(4,e,"MISS"),p++,d.splice(n,1),$("combo",0))}),$("total",h),$("miss",p),A()}()},10);return function(e,t,n,a,r,o){var c=document.querySelector(".btn-d"),i=document.querySelector(".btn-f"),l=document.querySelector(".btn-k"),s=document.querySelector(".btn-l"),u=document.querySelector(".current-socre"),m=0,d=function(e,t){return function(){if(e[0]){var n=e[0].centerPos.y,a=re().combo;n>11*r&&n<13*r&&(m++,a++,e.splice(0,1),ne(t,r,"HIT",a),$("hit",m),$("combo",a),u.textContent=re().score)}}},h=d(e,1),p=d(t,2),g=d(n,3),f=d(a,4),E=function(e){switch(e.keyCode){case 68:c.classList.add("btn-d-active"),ee(7,1,r),h();break;case 70:i.classList.add("btn-f-active"),ee(8,2,r),p();break;case 75:l.classList.add("btn-k-active"),ee(9,3,r),g();break;case 76:s.classList.add("btn-l-active"),ee(10,4,r),f()}},b=function(e){switch(te(r),e.keyCode){case 68:c.classList.remove("btn-d-active");break;case 70:i.classList.remove("btn-f-active");break;case 75:l.classList.remove("btn-k-active");break;case 76:s.classList.remove("btn-l-active")}};window.addEventListener("keydown",E,!1),window.addEventListener("keyup",b,!1),o.addEventListener("ended",function(){window.removeEventListener("keydown",E,!1),window.removeEventListener("keyup",b,!1)}),c.addEventListener("touchstart",function(){ee(7,1,r),h()}),i.addEventListener("touchstart",function(){ee(8,2,r),p()}),l.addEventListener("touchstart",function(){ee(9,3,r),g()}),s.addEventListener("touchstart",function(){ee(10,4,r),f()}),c.addEventListener("touchend",function(){te(r)}),i.addEventListener("touchend",function(){te(r)}),l.addEventListener("touchend",function(){te(r)}),s.addEventListener("touchend",function(){te(r)})}(i,l,s,d,e,n),function(){clearInterval(j),n.pause(),n.currentTime=0}},ce=(n(189),function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(o)))).state={unit:0},n.getCanvas=r.a.createRef(),n.setCanvasSize=function(){var e;e=window.innerWidth>1024?Math.round(.022*window.innerWidth):window.innerWidth>720?Math.round(.033*window.innerWidth):Math.round(.04*window.innerWidth),n.setState({unit:e})},n.storeRecord=function(e,t){if(localStorage.rankingData&&re().name){var n=function(e){return e<10?"0".concat(e):e},a=new Date,r="".concat(a.getFullYear(),"/").concat(n(a.getMonth()+1),"/").concat(n(a.getDate())," ").concat(n(a.getHours()),":").concat(n(a.getMinutes())),o={name:re().name,rank:re().rank,score:re().score,time:r};console.log("docId",e),console.log("difficulty",t),console.log("data",o)}},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){this.setCanvasSize()}},{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.match,a=t.location,r=t.fetchPlayingSongData,o=t.setInGameState,c=t.fetchRankingRecord,i=n.params.id,l=a.search.slice(1);r(i,l),c(i,l),function(e){var t=document.querySelector("#game-canvas").getContext("2d"),n=18*e,a=13*e;t.line=function(e,n,a,r,o){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.strokeStyle=a,t.shadowBlur=60,t.shadowColor=r,t.lineWidth=o,t.stroke()};for(var r=0;r<5;r++)t.line({x:(r+7)*e,y:0},{x:18*e/4*r,y:13*e},"#000",null,1);t.beginPath(),t.moveTo(7*e,0),t.lineTo(11*e,0),t.lineTo(18*e,13*e),t.lineTo(0,13*e),t.closePath(),t.fillStyle="rgba(0,0,0,.8)",t.fill(),t.line({x:.5*e,y:12*e},{x:17.5*e,y:12*e},"rgba(142, 226, 163, 0.8)",null,2),t.save(),t.beginPath(),t.translate(n/2,a/2),t.textAlign="center",t.font="".concat(e,"px Courier New"),t.fillStyle="#fff",t.fillText("Click to Start",0,0),t.restore()}(this.state.unit);this.getCanvas.current.addEventListener("click",function t(){return o(!0),e.getCanvas.current.removeEventListener("click",t),!1})}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props,n=t.game,a=t.match,r=t.location,o=t.setGameFinishState,c=t.auth,i=a.params.id,l=r.search.slice(1);if("error"===n.playingSongData&&function(e){var t=document.querySelector("#game-canvas").getContext("2d");t.clearRect(0,0,18*e,13*e),t.rect(0,0,18*e,13*e),t.fillStyle="#1d1d1d",t.fill();var n=18*e,a=13*e;t.save(),t.beginPath(),t.translate(n/2,a/2),t.textAlign="center",t.font="".concat(e,"px Courier New"),t.fillStyle="#fff",t.fillText("Coming Soon...",0,0),t.restore()}(this.state.unit),n.inGame&&n.playingSongData.audio&&!n.gameFinish){var s={name:c.name,total:0,hit:0,miss:0,combo:0};localStorage.setItem("rankingData",JSON.stringify(s)),this.stopGame=oe(this.state.unit,n.playingSongData.beatData,n.playingSongData.audio,l),n.playingSongData.audio.addEventListener("ended",function(){var t=re().score;e.stopGame(),o(!0),ae(e.state.unit,t),e.storeRecord(i,l),e.getCanvas.current.addEventListener("click",function(){window.location.hash="#/ranking/".concat(a.params.id).concat(r.search)})})}}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.setInGameState,n=e.setGameFinishState,a=e.game;t(!1),n(!1),a.inGame&&"error"!==a.playingSongData&&this.stopGame()}},{key:"render",value:function(){var e=this.state.unit,t={margin:"".concat(13*e+31,"px 0 0 0"),width:"".concat(18*e+1,"px")},n=this.props,a=n.game,o=n.ranking;return console.log(null===a.playingSongData),r.a.createElement("div",{className:"game-view"},r.a.createElement("div",{className:"game-wrap"},r.a.createElement("div",{className:"battle"},r.a.createElement(q,{record:o.record}),r.a.createElement(K,null)),r.a.createElement("div",{className:"canvas-wrap"},r.a.createElement(Z,{width:18*e,height:13*e}),r.a.createElement(J,{width:18*e,height:13*e,getCanvas:this.getCanvas})),r.a.createElement("div",{className:"game-buttons",style:t},r.a.createElement("div",{className:"game-btn btn-d"},"D"),r.a.createElement("div",{className:"game-btn btn-f"},"F"),r.a.createElement("div",{className:"game-btn btn-k"},"K"),r.a.createElement("div",{className:"game-btn btn-l"},"L"))))}}]),t}(r.a.Component)),ie=Object(i.b)(function(e){return{game:e.game,auth:e.auth,ranking:e.ranking}},{setInGameState:function(e){return{type:"SET_IN_GAME_STATE",payload:e}},fetchPlayingSongData:function(e,t){return function(n){var a={};V.collection("songList").doc(e).collection("gameData").get().then(function(e){e.forEach(function(e){a=Object.assign({audio:new Audio(e.data().url),beatData:JSON.parse(e.data()[t])}),n({type:"FETCH_PLAYING_SONG_DATA",payload:a})})}).catch(function(e){console.log("Error getting documents: ",e),n({type:"FETCH_PLAYING_SONG_DATA",payload:"error"})})}},setGameFinishState:function(e){return{type:"SET_GAME_FINISH_STATE",payload:e}},storeRecordToDB:function(e,t,n){return function(a){V.collection("songList").doc(e).collection(t).add(n).then(function(){console.log("lod\u4e00\u4e0b",n),a({type:"STORE_RECORD"})}).catch(function(e){console.log(e.message)})}},fetchRankingRecord:X})(ce),le=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"current-ranking"},r.a.createElement("div",{className:"current-ranking-row"},r.a.createElement("div",null,"TotalNotes"),r.a.createElement("div",null," ",re().total)),r.a.createElement("div",{className:"current-ranking-row"},r.a.createElement("div",null,"HIT"),r.a.createElement("div",null," ",re().hit)),r.a.createElement("div",{className:"current-ranking-row"},r.a.createElement("div",null,"MISS"),r.a.createElement("div",null," ",re().miss)),r.a.createElement("div",{className:"current-ranking-row"},r.a.createElement("div",null,"SCORE"),r.a.createElement("div",null," ",re().score)),r.a.createElement("div",{className:"current-ranking-row"},r.a.createElement("div",null,"ACCURATE"),r.a.createElement("div",null," ",re().accurate," %")),r.a.createElement("div",{className:"current-ranking-row"},r.a.createElement("div",null,"RANK"),r.a.createElement("div",null," ",re().rank))))},se=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,this.props.rankingRecord.map(function(e){return r.a.createElement("div",{className:"record-board",key:e.id},r.a.createElement("div",{className:"record-item"}," ",e.data.name),r.a.createElement("div",{className:"record-item"}," ",e.data.score),r.a.createElement("div",{className:"record-item"}," ",e.data.rank),r.a.createElement("div",{className:"record-item"}," ",e.data.time))}))}}]),t}(r.a.Component),ue=(n(190),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){localStorage.rankingData||(window.location.hash="#/");var e=this.props,t=e.match,n=e.location,a=e.fetchRankingRecord,r=n.search.slice(1);""!==r&&a(t.params.id,r)}},{key:"componentWillUnmount",value:function(){localStorage.removeItem("rankingData")}},{key:"render",value:function(){return r.a.createElement("div",{className:"ranking-view"},r.a.createElement("div",{className:"ranking-wrap"},localStorage.rankingData?r.a.createElement(le,null):null,r.a.createElement("div",{className:"record"},r.a.createElement("div",{className:"record-board title"},r.a.createElement("div",{className:"record-item"}," Name"),r.a.createElement("div",{className:"record-item"}," Score"),r.a.createElement("div",{className:"record-item"}," Rank"),r.a.createElement("div",{className:"record-item"}," Date")),r.a.createElement(se,{rankingRecord:this.props.ranking.record}))))}}]),t}(r.a.Component)),me=Object(i.b)(function(e){return{rankingData:e.rankingData,auth:e.auth,ranking:e.ranking}},{fetchRankingRecord:X})(ue),de=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return r.a.createElement(g.a,null,r.a.createElement(T,null),r.a.createElement(G,null),r.a.createElement("div",null,r.a.createElement(f.a,{path:"/",exact:!0,component:H}),r.a.createElement(f.a,{path:"/select",component:Q}),r.a.createElement(f.a,{path:"/game/:id",component:ie}),r.a.createElement(f.a,{path:"/ranking/:id",component:me})))}}]),t}(a.Component),he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_SONG_LIST":return t.payload;default:return e}},pe=n(7),ge={loginForm:!1,signUpForm:!1,mobileButtons:!1},fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SHOW_LOGIN_FORM":return Object(pe.a)({},e,{loginForm:t.payload});case"SHOW_SIGNUP_FORM":return Object(pe.a)({},e,{signUpForm:t.payload});case"SHOW_MOBILE_BUTTONS":return Object(pe.a)({},e,{mobileButtons:t.payload});case"LOGIN_SUCCESS":return Object(pe.a)({},e,{loginForm:!1});case"SIGH_UP_SUCCESS":return Object(pe.a)({},e,{signUpForm:!1});default:return e}},Ee={authError:null,uid:null,name:null},be=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN_ERROR":return Object(pe.a)({},e,{authError:"Login Failed"});case"LOGIN_SUCCESS":return e;case"SIGH_UP_SUCCESS":return Object(pe.a)({},e,{authError:null});case"SIGH_UP_ERROR":return Object(pe.a)({},e,{authError:t.payload});case"LOGOUT_SUCCESS":return Object(pe.a)({},e,{name:null});case"FETCH_USER_UID":return Object(pe.a)({},e,{uid:t.payload});case"FETCH_USER_NAME":return Object(pe.a)({},e,{name:t.payload});case"SHOW_LOGIN_FORM":case"SHOW_SIGNUP_FORM":return Object(pe.a)({},e,{authError:null});default:return e}},ve={record:[]},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_RANKING_RECORD":return Object(pe.a)({},e,{record:t.payload});default:return e}},Se={inGame:!1,playingSongData:null,gameFinish:!1},Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_IN_GAME_STATE":return Object(pe.a)({},e,{inGame:t.payload});case"FETCH_PLAYING_SONG_DATA":return Object(pe.a)({},e,{playingSongData:t.payload});case"SET_GAME_FINISH_STATE":return Object(pe.a)({},e,{gameFinish:t.payload});default:return e}},we=Object(l.c)({auth:be,showing:fe,songList:he,game:Oe,ranking:ye}),Ae=Object(l.d)(we,Object(l.a)(s.a));c.a.render(r.a.createElement(i.a,{store:Ae},r.a.createElement(de,null)),document.getElementById("root"))},89:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAAAYLlVAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAHdElNRQfjBQEOGipNUDWeAAAAzElEQVRo3u3YPQ5BURCG4fegQbTYALUrsQIhEdthA9bjLwoKomcBJCo01FfQkKuwiO8W33MWMDNnppgMmJmJBSBHnbwg9psTH2hyJRG9C1FgT0vYgV0gpiRMIM6wFYaHLVSYEEsmIGZMWVq+mZlZKgSgT5uiIPaTDUsYyjbChIRB4EZV2IF7hkQYHr5ZAl1hAqMA9OiIhnDNSli8mZlZalSZ8ZCsYw+mVGAh3QnnKTjTHaUDcICIi6wBZxr/Y3WNgqD6Fye+0v83MwP4AccbjaeK1AN/AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA1LTAxVDEyOjI2OjQyKzAyOjAwVQ1LxwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNS0wMVQxMjoyNjo0MiswMjowMCRQ83sAAAAZdEVYdFNvZnR3YXJlAHd3dy5pbmtzY2FwZS5vcmeb7jwaAAAAAElFTkSuQmCC"},91:function(e,t,n){e.exports=n(191)}},[[91,1,2]]]);
//# sourceMappingURL=main.f41ee8e5.chunk.js.map